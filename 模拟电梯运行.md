# 模拟电梯运行

## 简介

**利用8255控制4*4键盘与LED显示屏，利用8255控制步进电机正、反转，完成电梯上下方向控制，LED屏显示上行、下行、开门、关门、楼层号显示。 **

## 功能设计

*  利用8255控制4*4键盘与LCD显示屏，利用8255控制步进电机正、反转，完成电梯上下方向控制，LCD屏显示上行、下行、开门、关门、楼层号显示。
*  对电梯进行初始化，将目标楼层（l）初始化为1，当前楼层（p）初始化为1,上升序列数组（a[4]）初始化为{0,0,0,0,},下降数组（b[4]）初始化为{0,0,0,0,}。
*  通过4*4键盘模拟电梯内外键。对应如下：0--1楼外键上；1--1楼內键；2--2楼内键；3--3楼内键；4--4楼内键；5--2楼外键上；6--2楼外键下；7--3楼外键上；8--3楼外键下；9--4楼外键下；A--关门；B--开门。
*  步进电机：当电梯上行时逆时针旋转，下降时顺时针旋转。
*  LCD显示屏显示当前电梯状态，包括上行、下行和当前楼层、目标楼层。
*  8253将控制延时，每上升或下降一层需要1秒。
*  电梯用户在所在楼层按下外键使电梯到来，按下内键表明所去目标楼层 。

**模块设计图**

![1523018654250](C:\Users\qinwei\AppData\Local\Temp\1523018654250.png)

## 开发环境及平台

TPC-ZK-USB微机接口实验系统

该系统由一块USB总线接口模块、TPC-ZK验系统及集成开发环境软件组成。USB总线接口模块通过USB总线电缆与PC机相连，模块直接插在TPC-ZK实验系统上。其主要特点如下：

1. USB总线接口使用ISP1581/1583 USB2.0高速接口芯片，完全符合USB2.0规范。提供了高速USB下的通信能力，即插即用。
2. 满足《微机原理与接口技术》课程教学实验要求。实验台接口集成电路包括：可编程定时器/计数器（8254）、可编程并行接口（8255）、数/模转换器(DAC0832)、模/数转换器(ADC0809)等。外围电路包括：逻辑电平开关、LED显示、七段数码管显示、8X8双色发光二极管点阵及驱动电路、直流电机步进电机及驱动电路、电机测速用光藕电路、继电器及驱动电路、喇叭及驱动电路、键盘显示控制电路等。
3. 在USB接口模块上扩展有DMA控制器8237，可以完成微机DMA传送以及USB的DMA传送等实验。
4. 开放式结构，模块化设计支持开放实验。实验台上除固定电路外还设有用户扩展实验区。插座引脚都有对应的“自锁紧”插孔，利用这些插孔可以搭试更多的自己设计的实验，方便的进行课程设计。
5. 功能强大的软件集成开发环境，支持Win2000;WinXP 等操作系统（不支持WIN98系统）。可以方便的对程序进行编辑、编译、链接和调试，可以查看实验原理图，实验接线，实验程序并进行实验演示。可以增加和删除实验项目。
6. 实验程序可以使8086汇编和C语言编程实验。可以对汇编程序和C语言程序进行调试(C语言调试系统需安装了VC软件,因版权不提供该软件。
7. 系统还提供：字符、图形液晶显示实验模块；红外收发实验模块；无线通信实验模块；8279键盘显示实验模块等多种扩展实验模块。
8. 实验台自备电源，具有电源短路保护确保系统安全。
9. 使用USB接口与PC机相连，省却了打开主机箱安装接口卡的麻烦。

**开发平台：HQFC开发板**

TPC-ZK实验系统结构图如下：

![1523018017901](C:\Users\qinwei\AppData\Local\Temp\1523018017901.png)

## 程序流程图

![1523018461988](C:\Users\qinwei\AppData\Local\Temp\1523018461988.png)

**首先键盘检测按键，改变上升序列数组或下降序列数组。当目标楼层和当前楼层不同时，执行上楼或者下楼操作，每上一层或下一层调用异步电机，延时并显示在LCD显示屏上。当到一个目标楼层时，调用延时：开门-延时-关门。将延时写在步进电机函数里，上或下延时并使异步电机转动，若状态为停，则延时，但步进电机无输入。每进行上升或下降都要在检测是否有键按下。先执行最接近当前楼层的目标楼层的操作。到达后该楼层数组改为0。若键盘无键按下，则重复执行这一流程图。**

## 电路连接图

![1523018536987](C:\Users\qinwei\AppData\Local\Temp\1523018536987.png)



**工作原理：键盘输入想去的楼层，交给8255处理。调用主程序判断电梯运行状态。8255的PC4接收延时信号，进行延时操作，并输出信号，令异步电机工作，LCD显示屏显示电梯运行信息。**

实际电路连接如下：

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wps4C20.tmp.png)

## 运行结果

**初始化**

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wps60A.tmp.png)

**上升**

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wps38FD.tmp.png)

**下降**

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wpsA044.tmp.png)

***<u>检测中途插队情况:</u>***

**首先电梯前往4楼**

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wpsA7A3.tmp.png)

**中途三楼按下外键，目标楼层改为3楼**

![img](file:///C:\Users\qinwei\AppData\Local\Temp\ksohtml\wps4098.tmp.png)